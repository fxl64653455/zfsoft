<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.zfsoft.boot.apimgr.dao.daointerface.IApiAppDao" >
	
	<insert id="insert" parameterType="ApiAppModel">
		insert into zftal_api_app 
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="appId != null and appId != ''">app_id,</if>
			<if test="appName != null and appName != ''">app_name,</if>
			<if test="appDesc != null and appDesc != ''">app_desc,</if>
			<if test="appKey != null and appKey != ''">app_key,</if>
			<if test="appSecret != null and appSecret != ''">app_secret,</if>
			<if test="appOwner != null and appOwner != ''">app_owner,</if>
		</trim>
		<trim prefix=" values (" suffix=")" suffixOverrides=",">
			<if test="appId != null and appId != ''">#{appId,jdbcType=VARCHAR},</if>
			<if test="appName != null and appName != ''">#{appName,jdbcType=VARCHAR},</if>
			<if test="appDesc != null and appDesc != ''">#{appDesc,jdbcType=VARCHAR},</if>
			<if test="appKey != null and appKey != ''">#{appKey,jdbcType=VARCHAR},</if>
			<if test="appSecret != null and appSecret != ''">#{appSecret,jdbcType=VARCHAR},</if>
			<if test="appOwner != null and appOwner != ''">#{appOwner,jdbcType=VARCHAR},</if>
		</trim>
		<selectKey keyProperty="appId" resultType="String" order="BEFORE">select sys_guid() from dual</selectKey>
	</insert>
	
	<update id="update" parameterType="ApiAppModel">
		update zftal_api_app 
		<set>
			<if test="appName != null and appName != ''">app_name = #{appName,jdbcType=VARCHAR},</if>
			<if test="appDesc != null and appDesc != ''">app_desc = #{appDesc,jdbcType=VARCHAR},</if>
			<if test="appKey != null and appKey != ''">app_key = #{appKey,jdbcType=VARCHAR},</if>
			<if test="appSecret != null and appSecret != ''">app_secret = #{appSecret,jdbcType=VARCHAR},</if>
			<if test="appOwner != null and appOwner != ''">app_owner = #{appOwner,jdbcType=VARCHAR},</if>
		</set>
		where app_id = #{appId,jdbcType=VARCHAR}
	</update>
	
	<resultMap id="ApiAppModelMap" type="ApiAppModel">
		<result property="appId" column="app_id" />
		<result property="appName" column="app_name" />
		<result property="appDesc" column="app_desc" />
		<result property="appKey" column="app_key" />
		<result property="appSecret" column="app_secret" />
		<result property="appOwner" column="app_owner" />
	</resultMap>
	
	<select id="getPagedList" resultMap="ApiAppModelMap" parameterType="ApiAppModel">
		select app_id,app_name,app_desc,app_key,app_secret,app_owner from zftal_api_app 
		<where>
			<if test="appOwner != null and appOwner != ''">
				and app_owner = #{appOwner, jdbcType=VARCHAR} 
			</if>
			<if test="appName != null and appName != ''">
				and app_name like '%'|| #{appName} ||'%'
			</if>
		</where>
	</select>
	
	<select id="getModelList" resultMap="ApiAppModelMap" parameterType="ApiAppModel">
		select app_id,app_name,app_desc,app_key,app_secret,app_owner from zftal_api_app 
		<where>
			<if test="appOwner != null and appOwner != ''">
				and app_owner = #{appOwner, jdbcType=VARCHAR} 
			</if>
		</where>
	</select>
	
	<select id="getPagedApplyTableData" resultType="ApiAppModel" parameterType="ApiAppModel">
		select ZAA.APP_ID as appId,zaa.APP_NAME as appName,zaa.APP_DESC as appDesc,ZAA.APP_KEY as appKey,zaa.APP_SECRET as appSecret,
			ZAL.APPLY_STATUS as applyStatus,ZAL.APPLY_FOR as deployId 
			from ZFTAL_API_APP zaa
			left join ZFTAL_API_APPLY zal on ZAA.APP_ID = ZAL.APPLY_TO and ZAL.APPLY_FOR = #{deployId, jdbcType=VARCHAR}
		<where>
			<if test="appOwner != null and appOwner != ''">
				and zaa.app_owner = #{appOwner, jdbcType=VARCHAR} 
			</if>
			<if test="appName != null and appName != ''">
				and zaa.app_name like '%'|| #{appName} ||'%'
			</if>
		</where>
	</select>
	
	<select id="getModel" resultMap="ApiAppModelMap" parameterType="ApiAppModel">
		select app_id,app_name,app_desc,app_key,app_secret,app_owner from zftal_api_app where app_id = #{appId,jdbcType=VARCHAR}
	</select>
	 
	 <delete id="delete" parameterType="ApiAppModel">
		delete from zftal_api_app where app_id = #{appId,jdbcType=VARCHAR}
	</delete>
	
	<delete id="deleteMenu" parameterType="java.lang.String">
		delete from ZFTAL_XTGL_GNMKDMB where GNMKDM = #{dm,jdbcType=VARCHAR}
	</delete>
	
	<select id="hasMenu" resultType="java.lang.Integer" parameterType="java.lang.String">
		select count(GNMKDM) from ZFTAL_XTGL_GNMKDMB where GNMKDM = #{dm,jdbcType=VARCHAR}
	</select>
	
	<insert id="addAppMenu">
		insert into zftal_xtgl_gnmkdmb (gnmkdm,gnmkmc,fjgndm,dyym,xssx) values ('N060501','我的应用','N0605','/manager/api/app/index','1')
	</insert>
	
</mapper>